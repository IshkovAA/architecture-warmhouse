@startuml
' Настройки диаграммы
hide circle
skinparam linetype ortho

' Сущности
entity User {
  *id : integer
  --
  *name : varchar
  *email : varchar
  *password_hash : varchar
  *created_at : timestamp
}

entity House {
  *id : integer
  --
  *address : varchar
  *created_at : timestamp
}

entity UserHouse {
  *user_id : integer
  *house_id : integer
  --
  *role : varchar
}

entity DeviceType {
  *id : integer
  --
  *name : varchar
  *description : varchar
}

entity Device {
  *id : integer
  --
  *house_id : integer
  *type_id : integer
  *serial_number : varchar
  *status : varchar
  *created_at : timestamp
}

entity TelemetryData {
  *id : integer
  --
  *device_id : integer
  *value : float
  *timestamp : timestamp
}

entity Module {
  *id : integer
  --
  *name : varchar
  *description : varchar
}

entity UserModule {
  *user_id : integer
  *module_id : integer
  --
  *is_active : boolean
}

' Связи
User }o--o{ House : "владеет/принадлежит"
UserHouse }-- User : "пользователь"
UserHouse }-- House : "дом"

House --o{ Device : "содержит"
DeviceType --o{ Device : "имеет тип"
Device --o{ TelemetryData : "генерирует"
User --o{ UserModule : "активирует"
Module --o{ UserModule : "активирован"

@enduml