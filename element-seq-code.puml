@startuml seq
' Combined Sequence and Code Diagram

actor Client

box "Requests.Api" #LightBlue
  participant "RequestsTestApiController" as Controller <<API Controller>>
  queue "Command Bus" as CommandBus <<Mediator>>
  participant "InitializeMobileSignatureReleaseHandler" as Handler <<Command Handler>>
  participant "IRequestsRepository" as RequestsRepo <<Repository>>
  participant "IRequestStatusUpdater" as StatusUpdater <<Status Updater>>
  participant "IIntegrationEventsPublisher" as EventsPublisher <<Event Publisher>>
end box

' Sequence Diagram
Client -> Controller: POST /InitializeMobileSignatureRequest\n(requestId)
Controller -> CommandBus: Send(InitializeMobileSignatureReleaseCommand\n"Команда инициализации мобильной подписи")

note right of CommandBus
  See class definition of
  **InitializeMobileSignatureReleaseCommand** below
end note
CommandBus -> Handler: Handle(command)

Handler -> RequestsRepo: GetRequestById(requestId)
Handler -> StatusUpdater: UpdateStatus(request, **IsQueuedToQrCodeGeneration**)
Handler -> EventsPublisher: Publish(InitializeMobileSignatureReleaseEvent)
Handler --> RequestsRepo: UpdateRequestStatus

Controller <-- Client: HTTP 200 OK

... Class Diagram Below ...


'InitializeMobileSignatureReleaseHandler --> InitializeMobileSignatureReleaseCommand : Uses
'RequestsTestApiController --> InitializeMobileSignatureReleaseCommand : Creates

@enduml
