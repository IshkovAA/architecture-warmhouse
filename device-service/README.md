### Сервис для управления модулями умного дома "Smart Home"

Отвечает за отображение всех модулей, доступных для подключения в системе "Smart Home", 
и управление состоянием уже подключённых модулей.

### Логика работы с добавлением модуля
1. **Добавление модуля пользователем** <i>POST /modules/houses/:houseID/modules/:moduleID/assign</i>: 
   Пользователь отправляет запрос на ручку добавления модуля в свой дом.

2. **Отправка ивента в Kafka**:  
   Сервис отправляет ивент в Kafka для микросервиса пользователей (`UserService`) в топик `module.addition.topic`.

3. **Верификация пользователя**:  
   `UserService` проверяет, может ли пользователь установить данный модуль в свой дом.

4. **Прослушивание ответа верификации**:  
   Сервис слушает топик `module.verification.topic` для получения подтверждения верификации от `UserService`.

    - Если верификация пройдена успешно, создаётся запись в таблице `home_modules` с положительным статусом подключения.
    - Если верификация не пройдена, создаётся запись с отрицательным статусом.

### Логика управления модулем
1. **Управление модулем**:  
   После успешного подключения пользователь может отправлять команды в контроллер управления модулями. 
   Например, он может направить запрос на выполнение определённых действий через подключённый модуль.

* **Выключить модуль** — это позволяет временно приостановить работу любого подключённого модуля.
```
{
    "homeId": uuid,
    "moduleId": uuid,
    "state": {"running": "off"}
}
```

* **Открыть ворота** — позволяет отдать команду модулю автоматических ворот на открытие.
```
{
    "homeId": uuid,**
    "moduleId": uuid,
    "state": {"gate": "open"}
}
```

- **Увеличить температуру в помещении** — отдаётся команда на повышение температуры.  
  *(Пример: `"state": {"changeTemperature": -5}` — уменьшает температуру на 5 градусов, тем самым охлаждая помещение.)*
```
{
    "homeId": uuid,
    "moduleId": uuid,
    "state": {"changeTemperature": 5}
}
```

* А также **другие команды**, которые могут быть подключены и реализованы в микросервисе для конкретного оборудования.
```
{
    "homeId": uuid,
    "moduleId": uuid,
    "state": ...
}
```

После получения команд для физического оборудования, микросервис `Device Service` отправляет команды в Kafka в топик `equipment.change.state.topic`,
из Kafka они доходят до оборудования и оно изменяет своё состояние, осуществляя бизнес логику управления от клиента
через мобильное приложение.

2. **Отключения модуля**:  
   Помимо временной паузы работы модуля у сервиса `DeviceService` есть ручки для отключения/включения модуля:
   <i>POST /modules/houses/:houseID/modules/:moduleID/turn-on</i>
   <i>POST /modules/houses/:houseID/modules/:moduleID/turn-off</i>


После поднятия контейнеров более подробный Swagger доступен по ссылке:
http://0.0.0.0:8080/service/swagger/index.html
 
1. Получение всех модулей:
GET /modules

2. Получение модулей, подключенных к дому:
GET /modules/:houseID

3. Включение модуля:
PUT /modules/:houseID/:moduleID/turn-on

<i>
также может придти ивент на включение некоторых модулей от сервиса телеметрии, 
например датчик движения может триггеруть систему открыть ворота и подобные кейсы
</i>

4. Отключение модуля:
PUT /modules/:houseID/:moduleID/turn-off

<i>
также может придти ивент на выключение некоторых модулей от сервиса телеметрии,
например датчик тепла может триггеруть систему выключить котлы и подобные кейсы
</i>

5. Добавление нового модуля:
POST /houses/:houseID/modules


### C4 Device Service component diagram
![System Architecture](./Component_CleverVillageSystem_DeviceService.svg)